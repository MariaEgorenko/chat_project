{% extends "base.html" %}

{% block title %}Контакты - Web Messenger{% endblock %}

{% block header_right %}
  <button id="notifications-btn" class="flex items-center justify-center text-slate-500 hover:text-primary transition-colors">
    <span class="material-symbols-outlined text-2xl">notifications</span>
  </button>
  <div
    class="h-9 w-9 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-primary font-bold text-sm cursor-pointer hover:ring-2 hover:ring-primary hover:ring-offset-2 transition-all"
  >
    {{ user.login[:2] | upper }}
  </div>
  <button
    id="logout-button"
    class="cursor-pointer flex items-center gap-1 px-3 h-9 rounded-lg border border-slate-300 bg-white dark:bg-[#111722] text-slate-600 dark:text-slate-200 text-sm font-medium hover:bg-slate-50 dark:hover:bg-[#1a2233] hover:border-slate-400 transition-colors focus:outline-none focus:ring-2 focus:ring-primary/20"
  >
    <span class="material-symbols-outlined text-[18px]">logout</span>
    Выйти
  </button>
{% endblock %}

{% block content %}
<main class="flex flex-1 flex-col items-center py-10 px-4 sm:px-6">
  <div class="w-full max-w-5xl flex flex-col gap-6">
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
      <h1 class="text-3xl font-bold text-slate-900 dark:text-white tracking-tight">Контакты</h1>
      <div class="flex items-center gap-3">
        <a href="/chats" class="flex items-center gap-2 px-5 h-11 rounded-lg border border-slate-300 bg-white dark:bg-[#111722] text-slate-700 dark:text-slate-200 font-medium hover:bg-slate-50 dark:hover:bg-[#1a2233] hover:border-slate-400 transition-colors focus:outline-none focus:ring-2 focus:ring-primary/20">
          <span class="material-symbols-outlined text-[20px]">chat</span>
          Чаты
        </a>
        <button
          id="open-add-contact-modal-btn"
          class="cursor-pointer flex items-center gap-2 px-5 h-11 rounded-lg bg-primary text-white font-medium hover:bg-blue-600 active:bg-blue-700 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"
        >
          <span class="material-symbols-outlined text-[20px]">person_add</span>
          Добавить контакт
        </button>
      </div>
    </div>

    <div class="flex flex-col w-full rounded-2xl bg-white dark:bg-[#111722] border border-slate-200 dark:border-[#2a3750] shadow-sm min-h-[500px] overflow-hidden">
      <div class="p-6 border-b border-slate-200 dark:border-[#2a3750]">
        <div class="relative w-full">
          <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <span class="material-symbols-outlined text-slate-400 text-xl">search</span>
          </div>
          <input
            id="contacts-list-search"
            class="block w-full rounded-lg border-0 bg-slate-100 dark:bg-[#0f172a] py-2.5 pl-10 pr-4 text-slate-900 dark:text-white ring-1 ring-inset ring-slate-200 dark:ring-[#1f2937] placeholder:text-slate-400 dark:placeholder:text-[#6b7280] focus:ring-2 focus:ring-inset focus:ring-primary sm:text-sm sm:leading-6"
            placeholder="Поиск по вашим контактам..."
            type="text"
          />
        </div>
      </div>

      <!-- Контейнер для списка уже добавленных контактов -->
      <div id="contacts-container" class="flex-1 overflow-y-auto divide-y divide-slate-100 dark:divide-[#1f2937]">
      </div>
    </div>
  </div>

  <!-- Модальное окно поиска новых пользователей -->
  <div id="add-contact-modal" class="relative z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity"></div>
  
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
        
        <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#151b2b] text-left shadow-2xl transition-all w-full max-w-[480px] flex flex-col h-[600px]">
          
          <header class="flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-slate-800 shrink-0">
            <h2 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">Найти пользователя</h2>
            <button id="close-modal-btn" class="flex items-center justify-center w-8 h-8 rounded-full text-slate-500 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-white transition-colors cursor-pointer">
              <span class="material-symbols-outlined text-[24px]">close</span>
            </button>
          </header>
  
          <!-- Поиск (глобальный) -->
          <div class="px-6 py-3 shrink-0">
            <div class="relative group">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span class="material-symbols-outlined text-slate-400 group-focus-within:text-primary transition-colors text-[20px]">search</span>
              </div>
              <input 
                id="global-user-search-input"
                autofocus 
                class="block w-full pl-10 pr-4 py-3 bg-f6f6f8 dark:bg-[#0d121b] border-none rounded-lg text-sm text-slate-900 dark:text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all" 
                placeholder="Введите имя пользователя..." 
                type="text" 
                autocomplete="off"
              />
            </div>
          </div>
  
          <!-- Результаты глобального поиска -->
          <div id="global-search-results" class="flex-1 overflow-y-auto pt-2 px-2 custom-scrollbar">
             <div class="flex flex-col items-center justify-center h-full text-slate-400 text-sm">
                <span class="material-symbols-outlined text-4xl mb-2 opacity-30">search</span>
                <p>Введите запрос для поиска</p>
             </div>
          </div>
  
        </div>
      </div>
    </div>
  </div>
  <!-- Модальное окно "Заявка отправлена" -->
  <div id="request-sent-modal" class="relative z-[70] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-[2px] transition-opacity"></div>

    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div class="flex min-h-full items-center justify-center p-4 text-center">
        
        <!-- Окно уведомления -->
        <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#151b2b] text-center shadow-2xl transition-all w-full max-w-sm p-6">
          
          <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30 mb-4">
            <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl">check</span>
          </div>
          
          <h3 class="text-lg font-semibold leading-6 text-slate-900 dark:text-white mb-2">
            Готово!
          </h3>
          
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">
            Заявка в контакты успешно отправлена.
          </p>

          <button 
            id="close-success-modal-btn"
            type="button" 
            class="inline-flex w-full justify-center rounded-lg bg-primary px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary transition-colors"
          >
            Хорошо
          </button>

        </div>
      </div>
    </div>
  </div>
  <!-- Модальное окно "Заявка уже отправлена" -->
  <div id="request-exists-modal" class="relative z-[70] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-[2px] transition-opacity"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div class="flex min-h-full items-center justify-center p-4 text-center">
        <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#151b2b] text-center shadow-2xl transition-all w-full max-w-sm p-6">
          
          <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-yellow-100 dark:bg-yellow-900/30 mb-4">
            <span class="material-symbols-outlined text-yellow-600 dark:text-yellow-400 text-2xl">history</span>
          </div>
          
          <h3 class="text-lg font-semibold leading-6 text-slate-900 dark:text-white mb-2">
            Уже отправлено
          </h3>
          
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">
            Вы уже отправляли заявку этому пользователю. Дождитесь ответа.
          </p>

          <button 
            id="close-exists-modal-btn"
            type="button" 
            class="inline-flex w-full justify-center rounded-lg bg-slate-100 dark:bg-slate-700 px-3 py-2.5 text-sm font-semibold text-slate-900 dark:text-white shadow-sm hover:bg-slate-200 dark:hover:bg-slate-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 transition-colors"
          >
            Хорошо
          </button>

        </div>
      </div>
    </div>
  </div>
  <!-- Модальное окно Уведомлений -->
  <div id="notifications-modal" class="relative z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity"></div>

    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div class="flex min-h-full items-start justify-center p-4 text-center sm:p-6 mt-10">
        
        <!-- Окно -->
        <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#151b2b] text-left shadow-2xl transition-all w-full max-w-[400px] flex flex-col h-[500px]">
          
          <!-- Хедер -->
          <header class="flex items-center justify-between px-6 py-4 border-b border-slate-100 dark:border-slate-800 shrink-0">
            <h2 class="text-lg font-bold tracking-tight text-slate-900 dark:text-white">Уведомления</h2>
            <button id="close-notifications-btn" class="flex items-center justify-center w-8 h-8 rounded-full text-slate-500 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-white transition-colors cursor-pointer">
              <span class="material-symbols-outlined text-[20px]">close</span>
            </button>
          </header>

          <!-- Табы -->
          <div class="grid grid-cols-2 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/20 shrink-0">
             <button id="tab-incoming" class="py-3 text-sm font-medium border-b-2 border-primary text-primary transition-colors focus:outline-none">
                Входящие
             </button>
             <button id="tab-outgoing" class="py-3 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors focus:outline-none">
                Исходящие
             </button>
          </div>

          <!-- Список -->
          <div id="notifications-list" class="flex-1 overflow-y-auto p-2 custom-scrollbar">
          </div>

        </div>
      </div>
    </div>
  </div>
   <!-- Модальное окно "Контакт добавлен" (при встречной заявке) -->
  <div id="contact-added-modal" class="relative z-[70] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-[2px] transition-opacity"></div>
    <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
      <div class="flex min-h-full items-center justify-center p-4 text-center">
        <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#151b2b] text-center shadow-2xl transition-all w-full max-w-sm p-6">
          
          <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100 dark:bg-green-900/30 mb-4">
            <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl">person_check</span>
          </div>
          
          <h3 class="text-lg font-semibold leading-6 text-slate-900 dark:text-white mb-2">
            Контакт добавлен
          </h3>
          
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-6">
            У вас была входящая заявка от этого пользователя. Теперь вы в контактах.
          </p>

          <button 
            id="close-added-modal-btn"
            type="button" 
            class="inline-flex w-full justify-center rounded-lg bg-primary px-3 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-blue-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary transition-colors"
          >
            Хорошо
          </button>

        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
<script type="module" src="{{ url_for('static', path='js/contacts.js') }}"></script>
{% endblock %}
